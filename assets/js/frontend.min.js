jQuery(document).ready(function(e){function s(s){return e.grep(s,function(n,i){return i===e.inArray(n,s)})}function n(e){o.prop("disabled",!1),a.html('<div id="message" class="bp-template-notice error"><p>'+e.join("<br />")+"</p></div>").show(),c.show(),h.hide()}function i(s,i,t){var r={action:"get_message_recipients"};r[s]=i,e.post(ajaxurl,r,function(s){s=e.parseJSON(s),s.success?t(s.members):n(s.validation)})}function t(s,n,i,r,d,u){var g={action:"chunk_send_messages",subject:s,content:n,thread:i,noemail:r,members:d.splice(0,p)},m=u-d.length,f=Math.round(m/u*100);h.find(".information").text("Sending messages ("+m+"/"+u+")"),h.find(".progress-bar").css("width",f+"%"),e.post(ajaxurl,g,function(p){if(p=e.parseJSON(p),p.success)if(d.length>0)setTimeout(function(){t(s,n,i,r,d,u)},l);else{o.prop("disabled",!1);var g=i&&u>1?"s":"",m=1===u?"1 person":u+" people";a.html('<div id="message" class="bp-template-notice updated"><p>Message'+g+" sent to "+m+".</p></div>").show(),c.show(),h.hide()}else o.prop("disabled",!1),a.html('<div id="message" class="bp-template-notice error"><p>An unknown error occured.</p></div>').show(),c.show(),h.hide()})}function r(e,s,n,t){if(s.length>0){var o=s.splice(0,d);return void i("groups",o,function(i){e=e.concat(i),r(e,s,n,t)})}if(n.length>0){var a=n.splice(0,d);return void i("blogs",a,function(i){e=e.concat(i),r(e,s,n,t)})}t(e)}var o,a,c,d=500,p=100,l=500,h=e("#send_message_progress").hide();e("#mass_messaging_in_buddypress_checkboxes").on("change",'input[type="checkbox"]',function(){var s=e(this),n="mass_messaging_in_buddypress_select_all",i=s.parent(),t=i.parent().children(),r=t.filter("."+n).children('input[type="checkbox"]'),o=e(this).prop("checked");if(i.hasClass(n))t.children('input[type="checkbox"]').prop("checked",o);else{var a=t.not("."+n),c=a.length,d=0;a.each(function(){var s=e(this),n=s.children('input[type="checkbox"]').prop("checked");return n?void d++:0===d}),d===c?r.prop({indeterminate:!1,checked:!0}):0===d?r.prop({indeterminate:!1,checked:!1}):r.prop({indeterminate:!0,checked:!1})}}),c=e("#send_message_form.mass_messaging_in_buddypress"),c.length>0&&(a=e("#send_message_notice"),o=c.find("#send"),o.on("click",function(i){i.preventDefault();var d=e("#subject").val(),l=e("#message_content").val(),u=!0,g=[];if(""===d&&(u=!1,g.push("No message subject")),""===l&&(u=!1,g.push("No message content")),u){o.prop("disabled",!0),a.hide(),c.hide(),h.html('<div class="information">Getting list of members</div><div class="progress"><div class="progress-bar" style="width: 0%"></div></div>').show();var m=[],f=[],v=[],_=e("#mass_messaging_in_buddypress_list_members"),b=e("#mass_messaging_in_buddypress_list_groups"),k=e("#mass_messaging_in_buddypress_list_blogs");if(_.length>0){var y=_.find("input:checked");m=y.map(function(){return"ignore"!==this.value?this.value:null}).get()}if(b.length>0){var w=b.find("input:checked");f=w.map(function(){return"ignore"!==this.value?this.value:null}).get()}if(k.length>0){var x=k.find("input:checked");v=x.map(function(){return"ignore"!==this.value?this.value:null}).get()}var j=e("#thread").is(":checked"),N=e("#noemail").is(":checked");r(m,f,v,function(e){0===e.length?n(["No users selected"]):e.length>p&&j?n(["Sending to more than "+p+" members in a single thread is currently not supported"]):(c.find("#subject, #message_content").val(""),c.find('input[type="checkbox"]').prop("checked",!1),e=s(e),t(d,l,j,N,e,e.length))})}else n(g);e("body, html").scrollTop(a.offset().top)}))});
